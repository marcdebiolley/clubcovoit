<% content_for :head do %>
  <link rel="stylesheet" href="/css/pages/ride.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<% end %>

<div class="page-header">
  <div class="nav">
    <a class="btn" href="/clubs/<%= @group.invite_code %>">â† Retour au club</a>
  </div>
  <div class="nav">
    <a class="btn btn-secondary" href="/ride.html?id=<%= @ride.id %>">Ouvrir en plein Ã©cran</a>
  </div>
  </div>

<div class="header">
  <h1>ğŸš— DÃ©tails du covoiturage</h1>
  <p>Informations et participation</p>
 </div>

<div class="card" id="rideCard">
  <h2 id="rideTitle"></h2>
  <div><strong>ğŸ“…</strong> <span id="rideDate"></span></div>
  <div><strong>ğŸ“</strong> <span id="rideRoute"></span></div>
  <div><strong>â„¹ï¸</strong> <span id="rideNote"></span></div>

  <div class="stats">
    <div class="stat-card">
      <div class="stat-number" id="statDrivers">0</div>
      <div class="stat-label">Conducteurs</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="statPassengers">0</div>
      <div class="stat-label">Passagers</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="statSeats">0</div>
      <div class="stat-label">Places rÃ©servÃ©es</div>
    </div>
  </div>

  <h3>ğŸš˜ Conducteurs</h3>
  <ul id="driversList" class="passengers-list"></ul>

  <h3>ğŸ‘¥ Passagers</h3>
  <ul id="passengersList" class="passengers-list"></ul>

  <div class="participant-form">
    <h3>Rejoindre</h3>
    <form id="participantForm">
      <div class="form-group">
        <label for="pname">Votre nom *</label>
        <input id="pname" required />
      </div>
      <div class="form-group">
        <label>Vous Ãªtes *</label>
        <div class="radio-group">
          <label class="radio-option"><input type="radio" name="prole" value="driver" required /> Conducteur</label>
          <label class="radio-option"><input type="radio" name="prole" value="passenger" required /> Passager</label>
        </div>
      </div>
      <div class="form-group" id="carChoiceBox" style="display:none;">
        <label for="pcar">Choisir une voiture (optionnel)</label>
        <select id="pcar">
          <option value="">â€” En attendre d'affectation â€”</option>
        </select>
      </div>
      <div class="form-group" id="seatsOfferedBox" style="display:none;">
        <label for="pseats">Places offertes</label>
        <select id="pseats">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </div>
      <button class="btn" type="submit">âœ… Je participe</button>
    </form>
  </div>

  <button id="deleteRideBtn" class="btn btn-danger btn-small">ğŸ—‘ï¸ Supprimer ce covoiturage</button>
</div>

<div class="card">
  <h3>ğŸš— Ajouter une voiture</h3>
  <form id="carForm">
    <div class="form-group">
      <label for="car_name">Nom de la voiture</label>
      <input id="car_name" placeholder="Ex: Voiture Julien" />
    </div>
    <div class="form-group">
      <label for="car_origin">Lieu de dÃ©part</label>
      <input id="car_origin" placeholder="Ex: Parc sportif" />
    </div>
    <div class="form-group">
      <label for="car_address">Adresse de rendez-vous (pour la carte)</label>
      <input id="car_address" placeholder="Ex: 12 Rue du Stade, 4000 LiÃ¨ge" />
    </div>
    <div class="form-group">
      <label for="car_time">Heure de dÃ©part</label>
      <input id="car_time" type="time" />
    </div>
    <div class="form-group">
      <label for="car_seats">Places totales</label>
      <input id="car_seats" type="number" min="1" max="99" value="4" />
    </div>
    <div class="form-group">
      <label for="car_driver">Conducteur (nom)</label>
      <input id="car_driver" placeholder="Ex: Julien" />
    </div>
    <button class="btn" type="submit">â• Ajouter la voiture</button>
  </form>
</div>

<div class="voiture_dispo_list">
  <div class="card">
    <h3>ğŸš˜ Voitures de l'activitÃ©</h3>
    <div id="carsContainer" class="cars-list"></div>
  </div>
  <div class="card">
    <h3>ğŸ—ºï¸ Carte des points de dÃ©part</h3>
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px;">
      <label style="display:flex;gap:6px;align-items:center;">
        <input type="checkbox" id="toggleShowAllCars" />
        <span>Afficher toutes les voitures (y compris complÃ¨tes)</span>
      </label>
    </div>
    <div id="map" style="height: 360px; border-radius: var(--radius-large);"></div>
  </div>
</div>

<div class="card" id="waitingCard" style="display:none;">
  <h3>â³ En attente d'affectation</h3>
  <ul id="waitingList" class="passengers-list"></ul>
</div>

<% content_for :scripts do %>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script>
    window.rideId = <%= @ride.id %>;
  </script>
  <script src="/js/ride.js"></script>
<% end %>
